# Подробная настройка Google Cloud Console для Voit Bot

## Обзор интеграций

Ваш бот интегрируется с двумя Google сервисами:
1. **Google Drive API** - для чтения файлов с данными здоровья
2. **Google Fit API** - для получения данных о физической активности

## Шаг 1: Создание проекта в Google Cloud Console

### 1.1 Переход в Google Cloud Console
1. Откройте [Google Cloud Console](https://console.cloud.google.com/)
2. Войдите в свой Google аккаунт
3. Создайте новый проект или выберите существующий

### 1.2 Создание проекта
1. Нажмите на выпадающий список проектов в верхней части страницы
2. Нажмите "Новый проект"
3. Введите название проекта (например, "Voit Bot Integration")
4. Нажмите "Создать"

## Шаг 2: Включение необходимых API

### 2.1 Google Drive API
1. В меню слева выберите "API и сервисы" → "Библиотека"
2. Найдите "Google Drive API"
3. Нажмите на него и нажмите "Включить"

### 2.2 Google Fit API
1. В той же библиотеке найдите "Google Fit API"
2. Нажмите на него и нажмите "Включить"

### 2.3 Google+ API (если требуется)
1. Найдите "Google+ API" и включите его

## Шаг 3: Настройка экрана согласия OAuth

### 3.1 Переход к настройкам OAuth
1. В меню слева выберите "API и сервисы" → "Экраны согласия OAuth"
2. Выберите тип пользователя:
   - **Внешний** - если бот будет использоваться любыми пользователями
   - **Внутренний** - если только в вашей организации

### 3.2 Заполнение информации о приложении
1. **Название приложения**: Voit Bot
2. **Email пользователя**: ваш email
3. **Email службы поддержки**: ваш email
4. **Логотип приложения**: загрузите логотип (опционально)

### 3.3 Настройка области действия
1. Нажмите "Добавить или удалить области"
2. Добавьте следующие области:
   ```
   https://www.googleapis.com/auth/drive.readonly
   https://www.googleapis.com/auth/drive.metadata.readonly
   https://www.googleapis.com/auth/fitness.activity.read
   https://www.googleapis.com/auth/fitness.body.read
   https://www.googleapis.com/auth/fitness.heart_rate.read
   https://www.googleapis.com/auth/fitness.sleep.read
   ```

### 3.4 Тестовые пользователи
1. Если выбрали "Внешний" тип, добавьте тестовых пользователей
2. Добавьте email адреса пользователей, которые будут тестировать бота

## Шаг 4: Создание учетных данных OAuth 2.0

### 4.1 Создание OAuth 2.0 Client ID
1. В меню слева выберите "API и сервисы" → "Учетные данные"
2. Нажмите "Создать учетные данные" → "ID клиента OAuth 2.0"

### 4.2 Настройка типа приложения
1. Выберите тип приложения: **Веб-приложение**
2. Название: Voit Bot

### 4.3 Настройка URI перенаправления
Добавьте следующие URI перенаправления:
```
http://localhost:8000/auth/google/callback
http://localhost:3000/auth/google/callback
https://yourdomain.com/auth/google/callback
```

**Важно**: Замените `yourdomain.com` на ваш реальный домен, если бот будет работать в продакшене.

### 4.4 Получение учетных данных
После создания вы получите:
- **Client ID** (ID клиента)
- **Client Secret** (Секрет клиента)

## Шаг 5: Настройка переменных окружения

### 5.1 Создание .env файла
Создайте файл `.env` в корне проекта на основе `env.example`:

```bash
# Скопируйте env.example в .env
cp env.example .env
```

### 5.2 Заполнение Google переменных
Отредактируйте `.env` файл, добавив ваши учетные данные:

```env
# Google Fit Integration
GOOGLE_CLIENT_ID=your_actual_client_id_here
GOOGLE_CLIENT_SECRET=your_actual_client_secret_here
GOOGLE_REDIRECT_URI=http://localhost:8000/auth/google/callback
```

## Шаг 6: Настройка Google Fit на мобильном устройстве

### 6.1 Установка Google Fit
1. Установите приложение Google Fit на Android или iOS
2. Войдите в свой Google аккаунт
3. Разрешите доступ к данным о физической активности

### 6.2 Настройка источников данных
1. Откройте Google Fit
2. Перейдите в "Профиль" → "Настройки"
3. Убедитесь, что включены:
   - Шаги
   - Калории
   - Сон
   - Пульс
   - Вес

## Шаг 7: Тестирование интеграции

### 7.1 Запуск бота
1. Убедитесь, что все зависимости установлены:
   ```bash
   pip install -r requirements.txt
   ```

2. Запустите бота:
   ```bash
   python -m app.bot
   ```

### 7.2 Тест авторизации
1. Отправьте команду `/start` боту
2. Перейдите в меню настроек
3. Попробуйте подключить Google Fit или Google Drive

## Шаг 8: Настройка для продакшена

### 8.1 Обновление URI перенаправления
1. В Google Cloud Console обновите URI перенаправления
2. Добавьте ваш продакшен домен
3. Удалите localhost URI

### 8.2 Настройка экрана согласия
1. Перейдите в "Экраны согласия OAuth"
2. Нажмите "Отправить на проверку"
3. Заполните все необходимые поля
4. Дождитесь одобрения Google

### 8.3 Обновление .env файла
Обновите переменные окружения для продакшена:

```env
GOOGLE_REDIRECT_URI=https://yourdomain.com/auth/google/callback
```

## Шаг 9: Мониторинг и отладка

### 9.1 Просмотр логов
1. В Google Cloud Console перейдите в "Журналы"
2. Фильтруйте по API, которые вы используете
3. Отслеживайте ошибки и использование

### 9.2 Квоты и лимиты
1. Перейдите в "API и сервисы" → "Квоты"
2. Отслеживайте использование:
   - Google Drive API: 1000 запросов/100 секунд
   - Google Fit API: 1000 запросов/100 секунд

### 9.3 Настройка уведомлений
1. В "Квоты" настройте уведомления при приближении к лимитам
2. Установите пороги на 80% и 95% от лимита

## Часто встречающиеся проблемы

### Проблема 1: "redirect_uri_mismatch"
**Решение**: Проверьте, что URI в Google Cloud Console точно совпадает с URI в вашем коде.

### Проблема 2: "invalid_client"
**Решение**: Убедитесь, что Client ID и Client Secret скопированы правильно.

### Проблема 3: "access_denied"
**Решение**: Проверьте, что все необходимые области (scopes) добавлены в экран согласия.

### Проблема 4: "quota_exceeded"
**Решение**: Проверьте квоты API и увеличьте их при необходимости.

## Безопасность

### 9.1 Защита учетных данных
- Никогда не коммитьте `.env` файл в Git
- Используйте переменные окружения в продакшене
- Регулярно обновляйте Client Secret

### 9.2 Ограничение доступа
- Используйте минимально необходимые области доступа
- Регулярно проверяйте активные токены
- Настройте уведомления о подозрительной активности

## Дополнительные ресурсы

- [Google Cloud Console Documentation](https://cloud.google.com/docs)
- [Google Drive API Documentation](https://developers.google.com/drive/api)
- [Google Fit API Documentation](https://developers.google.com/fit/rest-api)
- [OAuth 2.0 Playground](https://developers.google.com/oauthplayground/)

## Поддержка

Если у вас возникли проблемы:
1. Проверьте логи бота
2. Проверьте логи в Google Cloud Console
3. Убедитесь, что все API включены
4. Проверьте настройки экрана согласия OAuth
