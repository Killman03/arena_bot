# Практические примеры настройки Google Cloud Console

## Пример 1: Создание проекта

### Скриншот 1: Выбор проекта
```
┌─────────────────────────────────────────────────────────────┐
│ Google Cloud Console                    [Проект ▼] [+ Новый] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Выберите проект:                                          │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [🔍] Поиск проектов...                              │   │
│  │                                                     │   │
│  │ ○ Проект 1                                          │   │
│  │ ○ Проект 2                                          │   │
│  │ ○ Проект 3                                          │   │
│  │                                                     │   │
│  │ [+ Создать проект]                                  │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### Скриншот 2: Создание нового проекта
```
┌─────────────────────────────────────────────────────────────┐
│ Создать проект                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Название проекта *                                        │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Voit Bot Integration                                │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ID проекта                                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ voit-bot-integration-123456                         │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [Отмена]                    [Создать]                    │
└─────────────────────────────────────────────────────────────┘
```

## Пример 2: Включение API

### Скриншот 3: Библиотека API
```
┌─────────────────────────────────────────────────────────────┐
│ API и сервисы > Библиотека                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🔍 Поиск API и сервисов                                  │
│                                                             │
│  Популярные API:                                          │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📊 Google Drive API                                 │   │
│  │    Управление файлами и папками                     │   │
│  │    [Включить]                                        │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🏃 Google Fit API                                   │   │
│  │    Доступ к данным о фитнесе                       │   │
│  │    [Включить]                                        │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## Пример 3: Настройка экрана согласия OAuth

### Скриншот 4: Тип пользователя
```
┌─────────────────────────────────────────────────────────────┐
│ Экран согласия OAuth                                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Тип пользователя *                                        │
│  ○ Внутренний                                             │
│    Доступ только для пользователей вашей организации      │
│                                                             │
│  ● Внешний                                                │
│    Доступ для любых пользователей с Google аккаунтом      │
│                                                             │
│  [Сохранить и продолжить]                                  │
└─────────────────────────────────────────────────────────────┘
```

### Скриншот 5: Информация о приложении
```
┌─────────────────────────────────────────────────────────────┐
│ Информация о приложении                                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Название приложения *                                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Voit Bot                                            │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  Email пользователя *                                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ your.email@gmail.com                                │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  Email службы поддержки                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ support@yourdomain.com                              │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [Сохранить и продолжить]                                  │
└─────────────────────────────────────────────────────────────┘
```

### Скриншот 6: Области действия
```
┌─────────────────────────────────────────────────────────────┐
│ Области действия                                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Добавить или удалить области                              │
│                                                             │
│  Доступные области:                                        │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ☑ https://www.googleapis.com/auth/drive.readonly   │   │
│  │ ☑ https://www.googleapis.com/auth/drive.metadata   │   │
│  │ ☑ https://www.googleapis.com/auth/fitness.activity │   │
│  │ ☑ https://www.googleapis.com/auth/fitness.body     │   │
│  │ ☑ https://www.googleapis.com/auth/fitness.heart    │   │
│  │ ☑ https://www.googleapis.com/auth/fitness.sleep    │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [Сохранить и продолжить]                                  │
└─────────────────────────────────────────────────────────────┘
```

## Пример 4: Создание учетных данных

### Скриншот 7: Тип учетных данных
```
┌─────────────────────────────────────────────────────────────┐
│ Создать учетные данные                                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Какой API вы используете?                                 │
│                                                             │
│  ○ Google Drive API                                       │
│  ○ Google Fit API                                         │
│  ○ Google+ API                                            │
│  ○ Другой API                                             │
│                                                             │
│  [Отмена]                    [Продолжить]                  │
└─────────────────────────────────────────────────────────────┘
```

### Скриншот 8: Настройка OAuth 2.0
```
┌─────────────────────────────────────────────────────────────┐
│ Создать ID клиента OAuth 2.0                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Тип приложения *                                          │
│  ○ Android                                                 │
│  ○ iOS                                                     │
│  ● Веб-приложение                                          │
│  ○ Универсальное приложение                               │
│                                                             │
│  Название *                                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Voit Bot                                            │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  Авторизованные URI перенаправления *                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ http://localhost:8000/auth/google/callback          │   │
│  │ http://localhost:3000/auth/google/callback          │   │
│  │ https://yourdomain.com/auth/google/callback         │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [Создать]                                                 │
└─────────────────────────────────────────────────────────────┘
```

## Пример 5: Полученные учетные данные

### Скриншот 9: Успешное создание
```
┌─────────────────────────────────────────────────────────────┐
│ ID клиента OAuth 2.0 создан                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ✅ Ваш ID клиента OAuth 2.0 успешно создан!              │
│                                                             │
│  ID клиента:                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 123456789-abcdefghijklmnop.apps.googleusercontent.com │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  Секрет клиента:                                           │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ GOCSPX-abcdefghijklmnopqrstuvwxyz                  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [Скачать JSON]              [Готово]                     │
└─────────────────────────────────────────────────────────────┘
```

## Пример 6: Настройка переменных окружения

### Файл .env
```env
# Telegram Bot
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# Database
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/voit_bot

# Google Integration
GOOGLE_CLIENT_ID=123456789-abcdefghijklmnop.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-abcdefghijklmnopqrstuvwxyz
GOOGLE_REDIRECT_URI=http://localhost:8000/auth/google/callback

# Other settings
DEFAULT_TIMEZONE=Europe/Moscow
LOG_LEVEL=INFO
```

## Пример 7: Тестирование авторизации

### Команды для тестирования
```bash
# 1. Установка зависимостей
pip install -r requirements.txt

# 2. Проверка переменных окружения
python -c "from app.config import settings; print(f'Client ID: {settings.google_client_id}')"

# 3. Запуск бота
python -m app.bot

# 4. В другом терминале - проверка логов
tail -f bot.log
```

### Тест в браузере
```
1. Откройте: http://localhost:8000/auth/google
2. Должен открыться Google OAuth экран
3. Войдите в свой Google аккаунт
4. Разрешите доступ приложению
5. Должны вернуться на callback URL
```

## Пример 8: Обработка ошибок

### Ошибка: redirect_uri_mismatch
```
Error: redirect_uri_mismatch
The redirect URI in the request: http://localhost:8000/auth/google/callback 
does not match the ones registered for this client ID.
```

**Решение:**
1. Проверьте URI в Google Cloud Console
2. Убедитесь, что нет лишних пробелов
3. Проверьте протокол (http vs https)

### Ошибка: invalid_client
```
Error: invalid_client
The OAuth client was not found.
```

**Решение:**
1. Проверьте Client ID в .env файле
2. Убедитесь, что проект активен
3. Проверьте, что API включены

### Ошибка: access_denied
```
Error: access_denied
The user denied access to the requested scope.
```

**Решение:**
1. Проверьте области в экране согласия OAuth
2. Убедитесь, что все необходимые области добавлены
3. Проверьте настройки тестовых пользователей

## Пример 9: Мониторинг использования

### Проверка квот
```
1. Google Cloud Console → API и сервисы → Квоты
2. Найдите "Google Drive API" и "Google Fit API"
3. Проверьте текущее использование
4. Настройте уведомления при 80% и 95%
```

### Просмотр логов
```
1. Google Cloud Console → Журналы
2. Фильтр: resource.type="api"
3. Фильтр: resource.labels.api="drive.googleapis.com"
4. Анализируйте ошибки и использование
```

## Пример 10: Настройка для продакшена

### Обновление URI перенаправления
```
1. Удалите localhost URI
2. Добавьте ваш продакшен домен:
   https://yourdomain.com/auth/google/callback
3. Обновите .env файл
4. Перезапустите бота
```

### Проверка экрана согласия
```
1. Убедитесь, что все поля заполнены
2. Добавьте политику конфиденциальности
3. Добавьте условия использования
4. Отправьте на проверку Google
5. Дождитесь одобрения
```

## Дополнительные советы

### Безопасность
- Регулярно обновляйте Client Secret
- Используйте HTTPS в продакшене
- Ограничьте области доступа минимумом
- Мониторьте активность

### Производительность
- Кэшируйте токены доступа
- Используйте batch запросы где возможно
- Обрабатывайте ошибки gracefully
- Логируйте все API вызовы

### Отладка
- Используйте Google OAuth Playground для тестирования
- Проверяйте Network tab в браузере
- Анализируйте ответы API
- Тестируйте с минимальными данными
