# Система напоминаний по To-Do задачам

## Описание

Добавлена функциональность для настройки времени напоминаний при создании задач в to-do листе. Пользователи могут указывать время напоминания как для ежедневных, так и для разовых задач.

## Новые возможности

### 1. Настройка напоминаний при создании задачи

При создании новой задачи (как разовой, так и ежедневной) пользователь теперь может:
- Выбрать, нужны ли ему напоминания
- Указать точное время для напоминаний в формате ЧЧ:ММ
- Получать напоминания в указанное время с учетом своего часового пояса

### 2. Типы напоминаний

- **Ежедневные задачи**: напоминания приходят каждый день в указанное время
- **Разовые задачи**: напоминания приходят в указанное время в день выполнения задачи

### 3. Отображение информации о напоминаниях

- В списке задач показывается время напоминания (например: ⏰09:00)
- В деталях задачи отображается полная информация о настройках напоминаний
- В списке выполненных задач также сохраняется информация о напоминаниях

## Техническая реализация

### Новые поля в модели Todo

```python
class Todo(Base):
    # ... существующие поля ...
    reminder_time: Mapped[str] = mapped_column(String(5), nullable=True)  # Format: "HH:MM"
    is_reminder_active: Mapped[bool] = mapped_column(Boolean, default=False)
```

### Новые состояния FSM

```python
class TodoStates(StatesGroup):
    # ... существующие состояния ...
    waiting_reminder = State()
    edit_reminder = State()
```

### Сервис напоминаний

Создан новый сервис `app/services/todo_reminders.py` с функциями:
- `get_active_todo_reminders()` - получение активных задач с напоминаниями
- `send_todo_reminders()` - отправка напоминаний по to-do задачам
- `send_test_todo_reminder()` - тестовая отправка напоминания

### Планировщик

Добавлена новая задача в планировщик:
- `_todo_reminders_job()` - проверяет и отправляет напоминания каждую минуту

## Использование

### Создание задачи с напоминанием

1. Выберите "Добавить задачу" в меню To-Do
2. Выберите тип задачи (разовая или ежедневная)
3. Введите название задачи
4. Для разовых задач: введите описание и дату
5. Выберите приоритет
6. Выберите "Да" для настройки напоминаний
7. Введите время в формате ЧЧ:ММ (например: 09:00)

### Тестирование

Для проверки работы системы напоминаний используйте команду:
```
/test_todo_reminder
```

## Миграция базы данных

Для применения изменений выполните:
```bash
alembic upgrade head
```

## Логирование

Система ведет подробные логи при отправке напоминаний:
- Время пользователя и UTC
- Часовой пояс пользователя
- Время напоминания
- Статус отправки

## Безопасность

- Напоминания отправляются только владельцу задачи
- Проверяется корректность формата времени
- Обработка ошибок при отправке напоминаний
