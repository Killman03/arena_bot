# üåç –ü–û–õ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ß–ê–°–û–í–´–• –ü–û–Ø–°–û–í

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ —á–µ—Ä–µ–∑ inline –∫–Ω–æ–ø–∫—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏, –∞ –Ω–µ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üîç –ü—Ä–∏—á–∏–Ω—ã
1. **–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª `session.commit()`** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –≥–ª–æ–±–∞–ª—å–Ω—ã–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å** - –≤—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
3. **CronTrigger –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞** - –∑–∞–¥–∞—á–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è

## ‚úÖ –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```python
# –î–æ–±–∞–≤–ª–µ–Ω session.commit() –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
async with session_scope() as session:
    db_user = (await session.execute(select(User).where(User.telegram_id == user.id))).scalar_one()
    db_user.timezone = tz
    # –í–∞–∂–Ω–æ! –ë–µ–∑ commit –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ
    await session.commit()
```

### 2. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
```python
def start(self) -> None:
    # –°–æ–∑–¥–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤ UTC –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏
    self.scheduler = AsyncIOScheduler(timezone="UTC")
    
    # –í—Å–µ –∑–∞–¥–∞—á–∏ —Ç–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    # –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞
    self.scheduler.add_job(self._daily_principle_job, IntervalTrigger(minutes=1))
    self.scheduler.add_job(self._daily_motivation_job, IntervalTrigger(minutes=1))
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
async def _daily_principle_job(self) -> None:
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –∞—Ä–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    async with self.session_factory() as session:
        try:
            # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            users = (await session.execute(select(User))).scalars().all()
            current_utc = datetime.now(timezone.utc)
            
            for user in users:
                try:
                    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    user_timezone = user.timezone or settings.default_timezone
                    user_time = current_utc.astimezone(ZoneInfo(user_timezone))
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—Ä–∞ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (7:00 –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
                    if user_time.hour == 7 and user_time.minute == 0:
                        await send_daily_principle(self.bot, session, user_id=user.id)
                        
                except Exception as e:
                    print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user.id}: {e}")
                    continue
                    
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –≤ _daily_principle_job: {e}")
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
```python
async def send_daily_principle(bot: Bot, session: AsyncSession, user_id: int = None) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø –∞—Ä–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å —É—Ç—Ä–µ–Ω–Ω–∏–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º"""
    if user_id:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        users = [await _get_user_by_id(session, user_id)]
    else:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        users = await _get_all_users(session)
    
    # ... –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
```

## üïê –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –í—Å–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É
- ‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –≤–ª–∏—è–ª–æ –Ω–∞ –≤—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- ‚ùå –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª CronTrigger —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- ‚úÖ –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ UTC, –Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üì± –í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

| –¢–∏–ø –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è | –í—Ä–µ–º—è –ø–æ –º–µ—Å—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ |
|----------------|---------------------------|
| üåÖ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä–µ–Ω—ã | 7:00 |
| üî• –ú–æ—Ç–∏–≤–∞—Ü–∏—è | 8:00 |
| üåô –í–µ—á–µ—Ä–Ω–∏–µ To-Do | 20:00 |
| üîÑ –°–±—Ä–æ—Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–¥–∞—á | 6:00 |

## üåç –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞

- üá∑üá∫ –ú–æ—Å–∫–≤–∞ (Europe/Moscow)
- üá∞üá¨ –ë–∏—à–∫–µ–∫ (Asia/Bishkek)
- üåç UTC
- üá¨üáß –õ–æ–Ω–¥–æ–Ω (Europe/London)
- üá©üá™ –ë–µ—Ä–ª–∏–Ω (Europe/Berlin)
- üá∫üá∏ –ù—å—é-–ô–æ—Ä–∫ (America/New_York)
- üá∫üá∏ –õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å (America/Los_Angeles)
- üáØüáµ –¢–æ–∫–∏–æ (Asia/Tokyo)
- üá¶üá™ –î—É–±–∞–π (Asia/Dubai)
- üá∏üá¨ –°–∏–Ω–≥–∞–ø—É—Ä (Asia/Singapore)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞:
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞

## üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ë–∏—à–∫–µ–∫–µ (UTC+6):**
- UTC –≤—Ä–µ–º—è: 1:00
- –ú–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 7:00
- ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä–µ–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ú–æ—Å–∫–≤–µ (UTC+3):**
- UTC –≤—Ä–µ–º—è: 4:00  
- –ú–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 7:00
- ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä–µ–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ù—å—é-–ô–æ—Ä–∫–µ (UTC-5):**
- UTC –≤—Ä–µ–º—è: 12:00
- –ú–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 7:00
- ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä–µ–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê** ‚úÖ

–¢–µ–ø–µ—Ä—å:
1. –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –í—Å–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö –ø–æ–ª—É—á–∞—é—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ —É–¥–æ–±–Ω–æ–µ –¥–ª—è –Ω–∏—Ö –≤—Ä–µ–º—è
4. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã –Ω–∞ –ª–µ—Ç–Ω–µ–µ/–∑–∏–º–Ω–µ–µ –≤—Ä–µ–º—è

**–ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üåç‚è∞**
